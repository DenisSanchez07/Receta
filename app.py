# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1CZ6l-AD9sQgwJr2HmrCLZTb373ZFEgK2
"""

import streamlit as st
from datetime import date
from tabulate import tabulate

# --- Funci√≥n para calcular el volumen en funci√≥n del nivel (%) ---
def calcular_volumen_por_nivel(x):
    return 0.0001 * (x ** 2) + 0.1763 * x

# --- App principal ---
def main():
    st.title("üß™ Preparaci√≥n de Soluci√≥n al 1% p/p")
    st.markdown("**C√°lculo de vol√∫menes, masas y texto t√©cnico tipo correo**")

    # Entradas del usuario
    st.header("üîß Ingreso de Datos")
    nivel_inicial = st.number_input("Nivel inicial del tanque (%)", min_value=0.0, max_value=100.0, value=15.0)
    nivel_final = st.number_input("Nivel final del tanque (%)", min_value=0.0, max_value=100.0, value=88.0)
    densidad_solvente = st.number_input("Densidad del solvente (kg/m¬≥)", value=729.8)

    # Constantes
    porcentaje_soluto = 0.01
    densidad_soluto = 930.0
    nombre_soluto = "EC-1010A"

    # C√°lculo de volumen
    volumen_objetivo = round(calcular_volumen_por_nivel(nivel_final) - calcular_volumen_por_nivel(nivel_inicial), 6)

    # C√°lculo de densidad real (base 100 kg de soluci√≥n)
    masa_base = 100.0
    masa_soluto_base = masa_base * porcentaje_soluto
    masa_solvente_base = masa_base - masa_soluto_base

    volumen_soluto_base = masa_soluto_base / densidad_soluto
    volumen_solvente_base = masa_solvente_base / densidad_solvente
    volumen_total_base = volumen_soluto_base + volumen_solvente_base

    densidad_real = masa_base / volumen_total_base

    # C√°lculo de masas y vol√∫menes reales
    masa_total = volumen_objetivo * densidad_real
    masa_soluto = masa_total * porcentaje_soluto
    masa_solvente = masa_total - masa_soluto

    volumen_soluto = masa_soluto / densidad_soluto
    volumen_solvente = masa_solvente / densidad_solvente

    # --- Mostrar tabla t√©cnica ---
    st.header("üìä Resultados T√©cnicos")

    data = [
        ["Nivel inicial del tanque", f"{nivel_inicial:.1f} %"],
        ["Nivel final del tanque", f"{nivel_final:.1f} %"],
        ["Volumen preparado", f"{volumen_objetivo:.4f} m¬≥"],
        ["Densidad real soluci√≥n", f"{densidad_real:.4f} kg/m¬≥"],
        ["Masa total soluci√≥n", f"{masa_total:.2f} kg"],
        ["Masa del soluto (1%)", f"{masa_soluto:.2f} kg"],
        ["Masa del solvente (99%)", f"{masa_solvente:.2f} kg"],
        ["Volumen del soluto", f"{volumen_soluto:.4f} m¬≥"],
        ["Volumen del solvente", f"{volumen_solvente:.4f} m¬≥"],
    ]
    st.table(data)

    # --- Generar texto t√©cnico tipo correo ---
    st.header("üìß Texto T√©cnico Tipo Correo")
    fecha_hoy = date.today().strftime("%Y-%m-%d")

    tabla_correo = [
        ["EC-1010A (soluto)", f"{int(round(volumen_soluto * 1000))} L", f"{int(round(masa_soluto))} kg"],
        ["Nafta pesada hidrotratada", f"{int(round(volumen_solvente * 1000))} L", f"{int(round(masa_solvente))} kg"],
        ["Total soluci√≥n preparada", f"{int(round(volumen_objetivo * 1000))} L", f"{int(round(masa_total))} kg"],
    ]
    tabla_texto = tabulate(tabla_correo, headers=["Componente", "Volumen", "Masa"], tablefmt="github")

    texto_correo = f"""
1.         Premisas para la preparaci√≥n:

a. Densidad de la nafta pesada hidrotratada: {densidad_solvente:.1f} kg/m¬≥ (Data JLBT {fecha_hoy}).
b. Nivel del drum HTN-D-025 a considerar: {nivel_inicial:.1f} %.
c. Objetivo para aforar es hasta el {nivel_final:.1f}%, para utilizar la m√°xima cantidad del PQ una vez abierto el cilindro, que sea f√°cil de contabilizar en campo y estar por debajo de la alarma de alta (90%).

2.         Preparaci√≥n de la Soluci√≥n:

{tabla_texto}

3.         Informaci√≥n para retirar producto de almac√©n (JIYA):

a. C√≥digo Material: 64-000-40699.
b. Proveedor: QUIMTIA.
c. Nombre comercial: {nombre_soluto}.
d. Presentaci√≥n: Cilindro de 193 kg.
"""
    st.code(texto_correo, language="markdown")

# Ejecutar app
if __name__ == "__main__":
    main()

st.markdown("---")
st.markdown(
    """
    <div style='text-align: center; color: gray; font-size: 14px;'>
        üìå Creado por <strong>Denis S√°nchez</strong> ‚Äì Refiner√≠a Talara, 2025
    </div>
    """,
    unsafe_allow_html=True
)
